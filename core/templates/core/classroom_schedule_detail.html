{% extends 'base.html' %}
{% load custom_filters %}
{% block content %}

<h2>Agenda semanal da Turma: {{ classroom.name }}</h2>

<div class="mb-3">
    <a href="{% url 'classrooms_manage' %}" class="btn btn-secondary btn-sm">← Voltar</a>
</div>

<div class="d-flex justify-content-between mb-3">
    <div>
        Semana de: {{ current_week|date:"d/m/Y" }}
    </div>
    <div>
        <a href="?week={{ current_week|add_days:"-7"|date:"Y-m-d" }}" class="btn btn-outline-secondary btn-sm">&laquo; Semana anterior</a>
        <a href="?week={{ current_week|add_days:"7"|date:"Y-m-d" }}" class="btn btn-outline-secondary btn-sm">Próxima semana &raquo;</a>
    </div>
</div>

<table class="table table-bordered table-striped table-hover shadow-sm">
    <thead class="table-light text-center">
        <tr>
            <th>Dia</th>
            <th>Horário</th>
            <th>Professor</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        {% for day in week_days %}
            {% with sessions=schedule|get_item:day %}
                {% if sessions %}
                    {% for session in sessions %}
                        <tr>
                            <td>{{ session.date|date:"d/m/Y" }}</td>
                            <td>{{ session.time|time:"H:i" }}</td>
                            <td>
                                {% if session.teacher %}
                                    {{ session.teacher.get_full_name }}
                                {% else %}
                                    <span class="text-muted">Sem professor</span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                {% if session.status == 'SCHEDULED' %}
                                    <span class="badge bg-success">Agendada</span>
                                {% elif session.status == 'COMPLETED' %}
                                    <span class="badge bg-primary">Concluída</span>
                                {% elif session.status == 'CANCELLED' %}
                                    <span class="badge bg-danger">Cancelada</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td>{{ day|date:"d/m/Y" }}</td>
                        <td colspan="3" class="text-center text-muted">Sem aulas</td>
                    </tr>
                {% endif %}
            {% endwith %}
        {% endfor %}
    </tbody>
</table>

{% endblock %}
